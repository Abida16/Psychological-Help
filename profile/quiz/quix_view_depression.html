<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script
            src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script type="text/javascript" >
        var count;
        var mentalhealth_level=0;
        var user_answer = new Array(20); // array of size 10, all elements undefined
        var  answer = [] ;
        var wop = [[], [],[],[],[],[]];
        var tot_weight = 0;

        function createfield(name ,number,idx,op_no)
        {

            var input = document.createElement("input");

            if(number == 0 )
            {
                input.style = "background-color:	#87CEFA;width : 300px ; height: 50px;font size:10 ;";
                input.type = "text";
                input.id="q"+idx;
                input.value = name ;
            }
            else if(number == 1)
            {


                input.type = "radio";
                //input.id= idx+op_no;
                // input.id= idx+op_no;
                input.id= op_no;
                input.name="op"+idx;
                input.value = idx;
                //input.name="op"+idx;


            }

            return input;

        }

        function check_answer() {
            correct_Answer = 0;
            var err = document.getElementById("error_message");
            var redflg = 0;
            var container = document.getElementById("container").children;
            console.log(container.length);


            for(var i= 0 ; i< count ; i++)
            {
                var qdiv = document.getElementById("qdiv"+i).children;
                for(var j= 0 ,flg = 0; j< qdiv.length ; j++) {
                    if (qdiv[j].type == "radio") {

                        if (!qdiv[j].checked) {
                            flg++;
                            if (flg == 5) {
                                redflg = 1;
                                var serial = parseInt(qdiv[j].value, 10) +1 ;
                                alert("Please answer question number " +serial);

                                break;
                            }
                        }
                        else
                        {
                            user_answer[qdiv[j].value]=qdiv[j].id;
                        }
                    }
                }


            }

            if(redflg == 0) {
                for (var i = 0; i < count; i++) {
                    var ans = user_answer[i];
                    mentalhealth_level += wop[ans][i] ;

                }

                $.ajax({
                    url: "/psychohelp/profile/access/usersinput.php",
                    type: "GET",
                    data: {
                        "data": user_answer,
                        "dbname": "user_answer",
                        "var": "quizsubmit",
                        "result": mentalhealth_level
                    },
                    success: function (feedback) {
                        alert(feedback);
                    }

                });

                console.log(mentalhealth_level);
                //  var parcentage = mentalhealth_level * 100 / tot_weight;

                alert("Your phycological strength is " + mentalhealth_level + "%\n");
            }


        }
        function load_quiz() {
            var  idx=0;
            var response = [
                [], [] ,[],[]
            ];


            xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {

                if (this.readyState == 4 && this.status == 200) {
                    response = xhttp.responseText;
                    var res = JSON.parse(response);
                    count = res['count'];var idx;

                    var container = document.getElementById("container");
                    // Clear previous contents of the container
                    while (container.hasChildNodes())
                    {
                        container.removeChild(container.lastChild);
                    }
                    var div = document.createElement('div');
                    div.appendChild(document.createTextNode("বিষন্নতা পরিমাপক"));
                    div.appendChild(document.createElement("br"));
                    div.appendChild(document.createTextNode("Developed by: Zahir Uddin and Dr. MahMudur Rahman, Department of Clinical Psychology, D.U."));
                    div.appendChild(document.createElement("br"));
                    div.appendChild(document.createElement("br"));
                    div.appendChild(document.createTextNode(" নিচের বিবৃতি গুলো পড়ে গত এক সপ্তাহের মধ্যে এই বিবৃতি গুলো আপনার ক্ষেত্রে কতটা প্রযোজ্য তা বিবৃতির পার্শ্বের সম্ভাব্য পাঁচটি উত্তরের যেটি প্রযোজ্য সেটির ঘরে টিক(√) চিহ্ন দিয়ে নির্দেশ করুন। আপনাকে সম্ভাব্য এই পাঁচটি উত্তর থেকে যে কোন একটিকে বেছে নিতে হবে এবং সবগুলো প্রশ্নের উত্তর দিতে হবে। অনুগ্রহ করে লক্ষ্য করুন সবগুলো বিবৃতির উত্তর দিয়েছেন কি না।"));
                    div.appendChild(document.createElement("br"));
                    container.appendChild(div);
                    for(idx = 0 ; idx < count ; idx++)
                    {


                        //   alert(count);// Create an <input> element, set its type and name attributes

                        var div = document.createElement('div');
                        div.id = 'qdiv'+idx;
                        div.className = 'block';


                        document.getElementsByTagName('body')[0].appendChild(div);

                        var input = createfield(res['q'][idx],0,idx,0);
                        var op1 = createfield(' ',1,idx,1);
                        var op2 = createfield(' ',1,idx,2);
                        var op3 = createfield(' ',1,idx,3);
                        var op4 = createfield(' ',1,idx,4);
                        var op5 = createfield(' ',1,idx,5);


                        var serial = idx+1;
                        div.appendChild(document.createTextNode(serial+"    "));
                        div.appendChild(input);
                        div.appendChild(document.createElement("br"));
                        div.appendChild(op1);
                        div.appendChild(document.createTextNode("একেবারেই প্রযোজ্য নয়"));
                        div.appendChild(document.createElement("br"));
                        div.appendChild(op2);
                        div.appendChild(document.createTextNode("প্রযোজ্য নয়"));
                        div.appendChild(document.createElement("br"));
                        div.appendChild(op3);
                        div.appendChild(document.createTextNode("মাঝামাঝি"));
                        div.appendChild(document.createElement("br"));
                        div.appendChild(op4);
                        div.appendChild(document.createTextNode("কিছুটা প্রযোজ্য"));
                        div.appendChild(document.createElement("br"));
                        div.appendChild(op5);
                        div.appendChild(document.createTextNode("পুরোপুরি প্রযোজ্য"));
                        div.appendChild(document.createElement("br"));
                        //   answer[idx] = res['ans'][idx];
                        wop[1][idx] = 0;
                        wop[2][idx] = 1;
                        wop[3][idx] = 2;
                        wop[4][idx] = 3;
                        wop[5][idx] = 4;
                        // console.log(answer[idx]+" "+res['w1'][idx]+"  "+res['w2'][idx]+" "+res['w3'][idx]+"\n");
                        // tot_weight+= answer[idx]*6;

                        container.appendChild(div);

                    }

                    container.appendChild(document.createElement("br"));
                    container.appendChild(document.createElement("br"));
                    var butn= document.createElement("input");
                    // butn.value="submit";


                    butn.type = "button" ;
                    butn.name = "ans_submit" ;
                    butn.value = "submit";
                    butn.onclick = check_answer;
                    //  var span = document.createElement('span');
                    // span.innerHTML = '<button id="but' + inc +'" onclick="callJavascriptFunction()" />';
                    container.appendChild(butn);

                }


            };



            xhttp.open("GET", "get_question.php?flag="+2, true);
            xhttp.send();
            return " ";

        }

    </script>




</head>
<body bgcolor="#20B2AA">
</br>
<center>
    <form  action = "/psychohelp/profile/access/user_profile.php"  method="post">
        <button  id="button" type="submit" value="Go back to your profile">
            Go back to your profile
        </button></br>
    </form>
    </br>


    <script> document.write(load_quiz())
    </script>
    <!-- <form > -->
    <div id="error_message"/>
    <div id="container"/>


    <!--</form> -->

    <p id="showmsg"></p>

</center>
</body>


</html>